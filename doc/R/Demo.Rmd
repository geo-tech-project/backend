
## Demo
Saving some example variables for testing the functions \
You can set your own variables here \
```{r setVariables }
trainingDataPath = "./R/training_data/trainingsdaten_koeln_25832.gpkg" #trainingdata should be located in the R folder of the backend
datetime = "2021-01-01/2021-12-31"
limit = 500
desiredBands = c("B02","B03","B04","SCL")
resolution = 100
cloudCoverageInPercentage = 100
```
## Demo for AOI

Create bbox of coordinates of the AOI
```{r bboxA0I}
bboxWGS84 <- getBBoxFromAOI(7,50,7.1,50.1)
bboxWGS84
``` 

Transform bbox CRS to the same CRS we use to create the cube view, so that every geometry alligns to each other
```{r bboxAOIUTM}
bboxUTM <- transformBBOXcrsToUTM(bboxWGS84)
bboxUTM
```

Querying images with rstac
```{r stacAOI}
items = stacRequest(bboxUTM, datetime, limit)
items
``` 
Creating an image collection
```{r imageCollectionAOI}
imageCollection =  createImageCollection(desiredBands, resolution, items)
imageCollection
``` 
Creating the cube view
```{r cubeViewAOI}
cubeView = createCubeView(bboxUTM, resolution, datetime)
cubeView
``` 

Create tif file
```{r createTifeFileAOI}
createTifFileFromAOI(imageCollection, cubeView)
```
Plotting
```{r plotting2}
plotTifFile("./R/processed_sentinel_images/aoi.tif")
```

## Demo for training data

Read the path to get the training data
```{r trainingData}
library(sf)
trainingData = read_sf(trainingDataPath)
trainingData
```
Transform training data to the same CRS we use to create the cube view, so that every geometry alligns to each other
```{r trainingData2}
trainingData <- transformTrainingDataToCRSFromCube(trainingData)
trainingData
```
Set BBOX to bbox of the shape from the training data
```{r bbox}
bbox = st_bbox(trainingData)
bbox
``` 
Querying images with rstac
```{r stacItems}
items = stacRequest(bbox, datetime, limit)
items
``` 
Creating an image collection
```{r imageCollection}
imageCollection = createImageCollection(desiredBands, cloudCoverageInPercentage, items)
imageCollection
``` 
Creating the cube view
```{r cubeView}
cubeView = createCubeView(bbox, resolution, datetime)
cubeView
``` 
Parallel computing
```{r threads}
gdalcubes_options(threads = 16)
```
Create tif file
```{r createTIF}
createTifFileFromTrainingData(imageCollection, cubeView, trainingData)
```
Plotting the file
```{r plotTrainingData}
plotTifFile("./R/processed_sentinel_images/trainingData.tif")
```






